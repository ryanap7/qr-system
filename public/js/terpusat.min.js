"use strict";
var integrasi_terpusat = (() => {
    const t = SiakClient.getUrlServer() + "Terpusat/apps/generateCaptcha";
    let e = () => {
        let e = (t, e) => {
            mUtil.isDesktopDevice() &&
                t.maxlength({
                    threshold: e,
                    warningClass:
                        "m-badge m-badge--warning m-badge--rounded m-badge--wide",
                    limitReachedClass:
                        "m-badge m-badge--success m-badge--rounded m-badge--wide",
                }),
                ((t) => {
                    SiakClient.dynamicKnownValidation(
                        t,
                        "required",
                        !0,
                        "CAPTCHA harus diisi"
                    ).remove(),
                        SiakClient.dynamicKnownValidation(
                            t,
                            "required",
                            !0,
                            "CAPTCHA harus diisi"
                        ).add(),
                        SiakClient.dynamicKnownValidation(
                            t,
                            "minlength",
                            t.attr("maxlength"),
                            "CAPTCHA kurang dari {0} karakter"
                        ).remove(),
                        SiakClient.dynamicKnownValidation(
                            t,
                            "minlength",
                            t.attr("maxlength"),
                            "CAPTCHA kurang dari {0} karakter"
                        ).add();
                })(t);
        };
        return {
            init: (a) => {
                let i = $(".captchaInputContainer", a);
                i.length &&
                    i.each((a, i) => {
                        ((a) => {
                            let i = $('input.captchaInput[type="text"]', a),
                                n = $("img.captchaImage", a),
                                l = $(
                                    'input.captchaValidator[type="hidden"]',
                                    a
                                );
                            $("button.captchaRefresh", a)
                                .on("click", (r) => {
                                    r.preventDefault(),
                                        r.stopPropagation(),
                                        r.stopImmediatePropagation();
                                    let o = $(r.currentTarget);
                                    SiakClient.loading_block(),
                                        i.val(""),
                                        i.focus(),
                                        $.ajax({
                                            url:
                                                t +
                                                "?_=" +
                                                SiakClient.uuidv4() +
                                                "-" +
                                                new Date().getTime(),
                                            type: "get",
                                            contentType:
                                                "application/json; charset=utf-8",
                                            dataType: "json",
                                            cache: !1,
                                            success: function (t, r) {
                                                let o =
                                                    "data:image/" +
                                                    t.captchaMime +
                                                    ";base64, " +
                                                    t.captchaImg;
                                                n
                                                    .removeAttr("src")
                                                    .attr("src", o),
                                                    SiakClient.loading_unblock(),
                                                    i
                                                        .removeAttr("maxlength")
                                                        .attr(
                                                            "maxlength",
                                                            t.captchaLength
                                                        ),
                                                    e(i, t.captchaLength),
                                                    l.val(
                                                        $.trim(
                                                            t.captchaValidator
                                                        )
                                                    ),
                                                    SiakClient.initInputmask(a);
                                            },
                                            error: function (t) {
                                                SiakClient.loading_unblock(),
                                                    o.click();
                                            },
                                        });
                                })
                                .click();
                        })($(i));
                    });
            },
        };
    };
    return {
        init: () => {
            $("body").removeClass("m-page--loading"),
                SiakClient.loading_block(),
                SiakClient.initPublicAccess().then(() => {
                    (() => {
                        let t = $("ul.my-info", $("#SIAKPage"));
                        SiakClient.appStaging()
                            .then((e) => {
                                if (t.length) {
                                    let a = $(".my-info-ip", t);
                                    a.length && a.text(e.ip_client);
                                    let i = $(".my-info-version", t);
                                    i.length && i.text(e.semantic);
                                    let n = $("li.my-info-stage", t);
                                    if (n.length) {
                                        let t = $("a", n),
                                            a = $("i", t);
                                        if ("" !== e.state) {
                                            let i =
                                                "la la-puzzle-piece m-animate-blink";
                                            "development" ===
                                                e.state.toLowerCase() &&
                                                (i =
                                                    "la la-code-fork m-animate-blink"),
                                                a.addClass(i),
                                                t
                                                    .removeData(
                                                        "original-title"
                                                    )
                                                    .data(
                                                        "original-title",
                                                        e.state
                                                    ),
                                                t
                                                    .removeData("toggle")
                                                    .data(
                                                        "toggle",
                                                        "m-tooltip"
                                                    ),
                                                t
                                                    .removeData("placement")
                                                    .data("placement", "left");
                                        } else
                                            a.addClass("la la-diamond"),
                                                t
                                                    .removeData(
                                                        "original-title"
                                                    )
                                                    .removeData("toggle")
                                                    .removeData("placement");
                                    }
                                    t.removeClass("m--hide");
                                }
                            })
                            .catch((t) => {
                                container.empty(),
                                    container.addClass("m--hide");
                            });
                    })();
                });
        },
        initPindai: () => {
            let t = $("#SIAKPage"),
                a = $("form#form_terpusat_pindai", t);
            a.length &&
                ($("body").on("contextmenu", (t) => (t.preventDefault(), !1)),
                ((t) => {
                    let e,
                        a = $.trim(new URL(location).pathname);
                    (a = a.substr("/Terpusat/Pindai/".length)),
                        (e = a.endsWith("/") ? a.substr(0, a.length - 1) : a),
                        $('input#inKey[type="hidden"]', t).val(e);
                })(a),
                $('input#CAPTCHA[type="text"]', a).val(""),
                e().init(a),
                $("button.captchaRefresh", a).length &&
                    a.on("ajaxErrorExtendedHandler", (t) => {
                        t.stopPropagation(),
                            t.stopImmediatePropagation(),
                            $("button.captchaRefresh", a).click();
                    }));
        },
    };
})();
$(document).ready(function () {
    integrasi_terpusat.init();
});
